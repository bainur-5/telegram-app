import { state, setState } from '../store.js';
import { retroButton } from '../ui/components.js';
const ton='/src/assets/toncoin_ton_logo.svg'; const quick=[0.5,1,2,5,10]; const wallet='UQBx_fvUPdBop74LLu3zeuzv_cL8UzIk-VsykVHeB0kBNhYD';
export function renderFinances(){const f=state.finances; const valid=Number(f.withdrawAmount.replace(',','.'))>=0.5&&f.withdrawAddress.trim().length>8;
 return `<main class="finances-page"><h2 class="finances-page__title">Финансы</h2><div class="finance-tabs" role="tablist" aria-label="Финансовые вкладки"><button type="button" role="tab" data-ftab="deposit" aria-selected="${f.tab==='deposit'}" class="finance-tabs__item ${f.tab==='deposit'?'is-active':''}">Пополнить</button><button type="button" role="tab" data-ftab="withdraw" aria-selected="${f.tab==='withdraw'}" class="finance-tabs__item ${f.tab==='withdraw'?'is-active':''}">Вывести</button></div>${f.tab==='deposit'?`<div class="deposit-panel"><section class="uic-card deposit-panel__card"><svg class="uic-card__frame" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true"><path d="M4 0 H100 V92 L97 100 H0 V13 Z" fill="none" stroke="var(--border)" stroke-width="1"/></svg><div class="uic-card__content"><div class="deposit-panel__title"><img src="${ton}" alt="" aria-hidden="true" /><span>Введите сумму</span></div><input class="deposit-panel__input" id="dep-amount" value="${f.amount}" inputmode="decimal" placeholder="0.00"/><div class="deposit-panel__quick">${quick.map(q=>`<button type="button" class="deposit-panel__chip" data-q="${q}">${q}</button>`).join('')}</div></div></section><section class="uic-card deposit-panel__card"><svg class="uic-card__frame" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true"><path d="M4 0 H100 V92 L97 100 H0 V13 Z" fill="none" stroke="var(--border)" stroke-width="1"/></svg><div class="uic-card__content"><h4 class="deposit-panel__sectionTitle">Способ оплаты</h4>${retroButton({text:'Открыть Tonkeeper',className:'deposit-panel__methodBtn deposit-panel__methodBtn--orange'})}${retroButton({text:'Подключить кошелёк',className:'deposit-panel__methodBtn deposit-panel__methodBtn--blue',style:'--rgb-border:#6DBAFB;--rgb-inner-border:#599FFA;--rgb-top:#6DBAFB;--rgb-bottom:#427FF9;--rgb-dot:rgba(95,205,251,.95);--rgb-background:#6DBAFB;--rgb-text-stroke:#427FF9;'})}</div></section><section class="uic-card deposit-panel__card"><svg class="uic-card__frame" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true"><path d="M4 0 H100 V92 L97 100 H0 V13 Z" fill="none" stroke="var(--border)" stroke-width="1"/></svg><div class="uic-card__content"><h4 class="deposit-panel__sectionTitle">Детали пополнения</h4><div class="deposit-panel__rowHead"><span>Адрес для депозита</span><button type="button" data-copy="wallet">Копировать</button></div><div class="deposit-panel__code">${wallet}</div><div class="deposit-panel__rowHead"><span>Memo (обязательно)</span><button type="button" data-copy="memo">Копировать</button></div><input class="deposit-panel__input deposit-panel__input--small" id="dep-memo" value="${f.memo}" placeholder="Memo"/></div></section></div>`:`<div class="withdraw-panel"><section class="uic-card withdraw-panel__card withdraw-panel__card--cyan"><svg class="uic-card__frame" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true"><path d="M4 0 H100 V92 L97 100 H0 V13 Z" fill="none" stroke="var(--border)" stroke-width="1"/></svg><div class="uic-card__content"><div class='withdraw-panel__title'><p class="withdraw-panel__availableLabel">Доступный баланс</p></div><p class="withdraw-panel__availableValue"><img src="${ton}" alt="" aria-hidden="true" /><span>0 TON</span></p></div></section><section class="uic-card withdraw-panel__card"><svg class="uic-card__frame" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true"><path d="M4 0 H100 V92 L97 100 H0 V13 Z" fill="none" stroke="var(--border)" stroke-width="1"/></svg><div class="uic-card__content"><h4 class="withdraw-panel__title">Сумма вывода</h4><input class="withdraw-panel__input" id="w-amount" value="${f.withdrawAmount}" inputmode="decimal" placeholder="0.00"/><div class="withdraw-panel__meta"><div><span>Минимум:</span><strong>0.5 TON</strong></div><div><span>Комиссия:</span><strong>5.00%</strong></div></div></div></section><section class="uic-card withdraw-panel__card"><svg class="uic-card__frame" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true"><path d="M4 0 H100 V92 L97 100 H0 V13 Z" fill="none" stroke="var(--border)" stroke-width="1"/></svg><div class="uic-card__content"><h4 class="withdraw-panel__title">TON адрес</h4><input class="withdraw-panel__input withdraw-panel__input--small" id="w-address" value="${f.withdrawAddress}" placeholder="EQ... или UQ..."/><p class="withdraw-panel__hint">Введите TON адрес, на который хотите получить средства</p></div></section><div class="withdraw-panel__warning">⚠ Пожалуйста, проверьте адрес. Вывод нельзя отменить.</div>${retroButton({text:'Вывести',className:'withdraw-panel__action',disabled:!valid,style:'--rgb-border:#6DBAFB;--rgb-inner-border:#599FFA;--rgb-top:#6DBAFB;--rgb-bottom:#427FF9;--rgb-dot:rgba(95,205,251,.95);--rgb-background:#6DBAFB;--rgb-text-stroke:#427FF9;'})}${retroButton({text:'Посмотреть историю выводов →',className:'withdraw-panel__history'})}</div>`}</main>`}
export function bindFinances(root){root.querySelectorAll('[data-ftab]').forEach(b=>b.onclick=()=>setState(s=>{s.finances.tab=b.dataset.ftab;})); const a=root.querySelector('#dep-amount'); if(a) a.oninput=e=>setState(s=>{s.finances.amount=e.target.value;}); root.querySelectorAll('[data-q]').forEach(b=>b.onclick=()=>setState(s=>{s.finances.amount=b.dataset.q;})); const m=root.querySelector('#dep-memo'); if(m) m.oninput=e=>setState(s=>{s.finances.memo=e.target.value;}); root.querySelectorAll('[data-copy]').forEach(b=>b.onclick=()=>navigator.clipboard?.writeText(b.dataset.copy==='wallet'?wallet:state.finances.memo)); const wa=root.querySelector('#w-amount'); if(wa) wa.oninput=e=>setState(s=>{s.finances.withdrawAmount=e.target.value;}); const ad=root.querySelector('#w-address'); if(ad) ad.oninput=e=>setState(s=>{s.finances.withdrawAddress=e.target.value;});}
